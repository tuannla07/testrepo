############################################################################################################
# This template sets the build number for the current build in Azure DevOps.
#-----------------------------------------------------------------------------------------------------------
# Parameters:
# - ReleaseVersion: The version string containing 'x' as a placeholder for the build version.
# - BuildVersion: The build version number to replace 'x' in the ReleaseVersion string.
##############################################################################################################

parameters:
  - name: "ReleaseVersion"
    type: string

  - name: "BuildVersion"
    type: string
    default: ""

steps:
  - script: |
      set -euo pipefail

      releaseVersion="${{ parameters.ReleaseVersion }}"
      buildVersion="${{ parameters.BuildVersion }}"

      # Validate that version is not empty
      if [[ -z "$releaseVersion" ]]; then
        echo "‚ùå Error: ReleaseVersion parameter is empty."
        exit 1
      fi

      newName="${releaseVersion}"

      # replace 'x' in version with buildVersion if buildVersion is numeric
      if [[ "$buildVersion" =~ ^[0-9]+$ ]]; then
        newName="${releaseVersion/x/$buildVersion}"
      fi

      echo "Setting build number to: $newName"
      echo "##vso[build.updatebuildnumber]$newName"
    displayName: "Set build number (title)"
    # env:
    #   SYSTEM_ACCESSTOKEN: $(System.AccessToken)
